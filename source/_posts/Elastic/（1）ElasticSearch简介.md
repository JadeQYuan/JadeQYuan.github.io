title: ElasticSearch简介
description: ElasticSearch简介
categories:
  - Elastic
author: Jade
date: 2023-09-10 15:00:00
---


## 文档和索引
- 分布式文档存储。
- 存储复杂数据结构，使用JSON存储。
- 集群部署，多节点访问最新数据。
---
- 近实时（within 1 second） 全文检索。
- 使用倒排索引支持快速全文检索。
- 分词。
---
- index -> document -> filed。
- 键值对存储。
- 不同类型的字段存储在不同的索引中，text存储在倒排索引中，数据和地理坐标存储在BKD树。
---
- schema-less。
- dynamic mapping。
---
- 自定义mapping以控制字段的存储和索引。
    - 区分全文检索和精准匹配。
    - 基于指定语言进行分词。
    - 优化字段匹配方式。
    - 使用自定义数据格式。
    - 指定无法自动检测的数据类型，如get_point、get_shape。
---
- 单个字段使用多种分词方式。如一个字段有test和keyword。
---
- 保存时分词，查询时也进行分词。

## 查询和分词
- 文档存储和检索，基于Apache Lucene搜索引擎库。
- ElasticSearch提供了简单易用的REST API。
- 测试方面，可以通过命令行，Kibana的控制台。
- 应用集成时，使用对应语言的ElasticSearch Client。
- Java、JavaScript、Go、.Net、PHP、Perl、Python、Ruby。
---
- REST APIs支持结构化查询，全文查询，和包含两者的复杂查询。
- 结构化查询类型于sql。
---
- 模糊查询、近似查询、前缀匹配、自动填充建议。
- 支持高性能查询数值型和地理坐标类型。
---
- JSON-Style query language（Query DSL）。
- SQL-style queries。JDBC、ODBC驱动。
---
- 聚合，可以构建复杂的数据摘要，并获得世俗据的指标、模式、趋势。
- 聚合使用相同的数据结构，也是非常快的。
- 实时。
---
- 聚合与查询同时进行。
- 聚合基于查询结果，因此聚合也可以包含查询结果。
---
- 机器学习。
    - 偏差。
    - 统计稀有度。
    - 异常侦测。

## 可扩展性和分片
- 高可用，可扩展。 只需添加节点到集群。
    - index是物理分片的逻辑分组。每个分片是个自包含索引。
    - 文档分布在多个分片上，分片分布在多个节点上，确保冗余。
    - 主分片、副本分片。副本分片是主分片的拷贝。
    - 主分片的数量在创建索引时固定，副本分片可随时调整。
- 分片越多，维护索引的开销就越大。
- 分片越大，需要移动时，时间越长。
---
- 可靠的链接，将节点置于同一数据中心或相邻的数据中心。
- 高可用，将节点置于不同的数据中心。
- CCR，跨集群复制。
- 跨集群复制是主动-被动的。
- 辅助集群的索引是只读的。
--- 
- 企业级，安全、管理、监控集群。 - Kibana
- Kibana，数据汇总，索引生命周期管理。

## 扩展
### 节点
- 主节点 维护集群的状态，所有节点的信息，所有的索引及mapping，配置信息，分片路由等。
- 数据节点 负责数据的存储。
- 协调节点 协调客户端的请求，分发到合适的节点，并把结果汇集到一起。
一个节点可以充当一个或多个角色，默认三个角色都有。

### 分片
- 主分片 创建时确定数量，无法修改。
- 副本分片 数量可修改。可用于查询。

#### 重索引
reindex
创建新的索引，旧的保留。
新的索引需要提前先创建好。

### 路由
ES默认通过_id进行哈希，将文档分布在各个分片中。
可以通过指定routing参数，使用routing参数进行哈希，使相同routing的文档分布在同一个分片中。
查询时可以指定分片中查询，不用在全部分片中查询，可以更快（验证？？？）。
可配置为所有文档使用定制路由，并拒绝索引没有定制路由的文档。

指定路由后怎么计算哈希，是否所有的路由最终指向同一个分片 ？？？
  --- 会重新计算_id ？？？

### 水平扩展
新增节点后，分片重新分配。 --- 新的新增，旧的删除数据？？？