title: 并发编程
categories:
  - Java
  - 并发
tags:
  - How
description: 并发编程
author: Jade
date: 2020-07-21 13:50:00
---
> 操作系统通过时间片算法来并行执行各个程序。  
> 并发编程是指在同一台处理器上，并发处理多个任务。

## 相关概念
### 进程
操作系统进行资源分配的最小单位。
### 线程
操作系统能够进行运算调度的最小单位。
### 临界区
表示一种公共资源或共享数据，同一时间，只允许一个线程访问。
### 缓冲区
内存的一部分，用来缓冲输入或输出的数据。

## 并发编程解决的问题
- 线程间的通信问题
> 通信方式
	 - 数据共享 通过读写公共内存中的公共状态来隐式进行通信。
	 - 消息传递 通过明确的发送消息来显式进行通信（Java中典型的消息传递方式是wait()和notify()）。
- 线程间的同步问题
> 同步 指程序用于控制不同线程之间操作发生相对顺序的机制。

## 计算机内存模型

### 高速缓存
随着CPU技术的发展，CPU的执行速度越来越快，而内存的速度没有多大变化，于是，为了提高CPU利用率，在CPU和内存之间增加高速缓存。  
按照数据读取顺序和与CPU结合的紧密程度，CPU缓存可分为一级缓存（L1），二级缓存（L2），部分高端CPU还具有三级缓存（L3）。  
多CPU/多核CPU每个核心都含有一套L1（L1、L2）缓存，而共享L2（L3）缓存。  
基于高速缓存的存储交互很好地解决了处理器与内存的速度矛盾，但是也为操作系统引入了一个新的问题---缓存一致性，从而带来更高的复杂度。
### 缓存一致性协议
MSI、MESI、MOSI、Synapse、Firefly、Dragon Protocol
#### MESI
##### 状态
- M Modified 修改
- E Exclusive 独享
- S Shared 共享
- I Invalid 无效
##### 状态转换图
高速缓存行数据状态有四种，引起数据状态转换的操作也有四种，所以共有16中状态转换的情况。
![upload successful](/images/pasted-1.png)
> CPU高速缓存通过总线连接，总线还连接了主存。  
> 对于Local Read 和 Local Write 操作，不经过总线，不会被其它CPU控制器监听到。
> 对于Remote Read 和 Remote Write 操作，需要其它CPU共同参与，所以这两个操作所有CPU控制器都能监听到，并能知道是不是自己发出的。

##### 允许状态图
对于任意给定的高速缓存对，给定高速缓存行的允许状态如图。
![upload successful](/images/pasted-2.png)

## JVM内存模型
### 分类
根据JVM规范，JVM内存共分为虚拟机栈，堆，方法区，程序计数器，本地方法栈五个部分。
### 问题
- 不可见
> 多个线程从主存中读取数据，其中一个线程的修改对其它线程不可见。

使用volatile关键字，表示只能从主存中读取，修改后写回主存。
- 竞争
> 多个线程同时修改同一份数据。

使用synchronized关键字，对数据加锁，释放锁之前其它线程不能访问。


## JMM
Java Memory Model，Java内存模型,定义了JVM在计算机内存中的工作方式。JVM是整个计算机虚拟模型，所以JMM属于JVM。  
在不同的硬件生产商和不同的操作系统下，内存的访问逻辑有一定的差异，JMM就是为了屏蔽系统和硬件的差异。  
### 内存模型
JMM用来描述JVM是如何和计算机内存交互的。而JVM是计算机的一个模型，自然包含内存结构。



<p style="text-align: center"><strong>END</strong></p>