title: 安全
description: 安全
categories: 
  - Java
  - 核心技术卷Ⅱ
author: Jade
date: 2022-01-17 10:00:00
---

{% markmap %}

## 9.0 序
- Java技术与其他的语言和系统有所不同，在那些语言和系统中安全是在事后才想到要去实现的，或者仅仅是对破坏的一种应对措施。
- 对Java技术来说，安全机制是一个不可分割的组成部分。

- Java技术提供了三种确保安全的机制。
- 语言设计特性（对数组的边界进行检查，无不受检查的类型转换，无指针算法等）。
- 访问控制机制，用于控制代码能够执行的操作（比如文件访问，网络访问等）。
- 代码签名，利用该特性，代码的作者就能够用标准的加密算法来认证Java代码。

## 9.1 类加载器
- Java编译器会为虚拟机转换源指令。
- 类加载器： 引导类加载器、扩展类加载器、系统类加载器。
- 引导类加载器负责加载系统类（rt.jar）。引导类加载器没有对应的ClassLoader对象。
- 扩展类加载器用于从jre/lib/ext目录加载标准的扩展。
- 系统类加载器用于加载应用类。在由CLASSPATH环境变量或者-classpath命令行选项设置的类路径中的目录或者是JAR/ZIP文件里查找这些类。
- 在Oracle的Java语言实现中，扩展类加载器和系统类加载器都是用Java来实现的。它们都是URLClassLoader类的实例。

- 类加载器有一种父子关系。
- 除了引导类加载器外，每个类加载器都有一个父类加载器。
- 类加载器倒置。
- 每个线程都有一个类加载器的引用，称为上下文类加载器。主线程的上下文类加载器是系统类加载器。
- 当新线程创建时，它的上下文类加载器会被设置成为创建该线程的上下文类加载器。

- 在虚拟机中，类是由它的全名和类加载器来确定的。
- 可以编写自己的用于特殊目的的类加载器。
- 加密。

## 9.2 字节码校验
- 当类加载器将新加载的Java平台类的字节码传递给虚拟机时，这些字节码首先要接受校验器的校验。
- 校验器负责检查那些指令无法执行的明显由破坏性的操作。
- 除了系统类外，所有的类都要校验。

- 变量要在使用之前进行初始化。
- 方法调用与对象引用类型之间要匹配。
- 访问私有数据和方法的规则没有被违反。
- 对本地变量的访问都落在运行时堆栈内。
- 运行时堆栈没有溢出。

- 实际上，用Java语言编译器生成的类文件总是可以通过校验的。
- 校验器总是在防范被故意篡改的类文件，而不仅仅只是检查编译器产生的类文件。

## 9.3 安全管理器与访问权限
- 一旦某个类被加载到虚拟机中，并由检验器检查过之后，Java平台的第二种安全机制就会启动，这个机制就是安全管理器。
- 安全管理器是一个负责控制具体操作是否允许执行的类。

- 创建一个新的类加载器。
- 退出虚拟机
- 使用反射访问另一个类的成员。
- 访问本地文件。
- 打开socket连接。
- 启动打印作业。
- 访问系统剪贴板。
- 访问AWT事件队列。
- 打开一个顶层窗口。

- 在运行Java应用程序时，默认的设置是不安装安全管理器的，这样所有的操作都是允许的。
- Java平台的安全管理器，允许对各个安全访问权限实施细致的控制。

- JDK 1.0具有一个非常简单的安全模型，即本地类拥有所有的权限，而远程类只能在沙盒里运行。
- JDK 1.1，如果远程代码带有可信赖的实体的签名，将被赋予和本地类相同的访问权限。
- 从Java SE 1.2开始，Java平台拥有了更灵活的安全机制，它的安全策略建立了代码来源和访问权限集之间的映射关系。
- 代码来源是由一个代码位置和一个证书集指定的。代码位置指定了代码的来源。证书的目的是要由某一方来保障代码没有被篡改过。
- 权限是指由安全管理器负责检查的任何属性。Java平台支持了许多访问权限类，每个类都封装了特定权限的详细信息。
- 每个类都有一个保护域，它是一个用于封装类的代码来源和权限集合的对象。
- 当SecurityManager类需要检查某个权限时，它要查看当前位于调用堆栈上的所有方法的类，然后获得所有类的保护域，并且询问。

- 策略管理器要读取相应的策略文件，这些文件包含了将代码来源映射为权限的指令。
- 可以将策略文件安装在标准位置上。
- 默认位置：Java平台主目录java.policy文件； 用户主目录的.java.policy文件。可以在java.security配置文件中修改。或配置显示的策略文件。
- 在安装安全管理器之前，看不到策略文件的作用。

- 实现自己的权限类，可以继承Permission类，并提供方法。

## 9.4 用户认证
- Java认证和授权服务（JAAS）包含两部分：认证部分主要负责确定程序使用者的身份，而授权将各个用户映射到相应的权限。
- JAAS是一个可插拔的API，可以将Java应用程序与实现认证的特定技术分离开来。
- JAAS还支持UNIX登录、NT登录、Kerberos认证和基于证书的认证。
- 一旦用户通过认证，就可以为其附加一组权限。

## 9.5 数字签名
- ...

## 9.6 代码签名
- ...

## 9.7 加密
- ...

{% endmarkmap %}
